import{i as K}from"./validator.0c34c3e7.js";import{S as j,u as E}from"./SelectGroup.c2b280b8.js";import{_ as C,d as L,r as W}from"./index.a7e39867.js";import{ah as s,ar as P,Q as G,o as _,c as V,V as e,P as i,a as m,T as b,O as y,S as v,U as p,L as Q,ax as q,aA as J,a9 as X}from"./vendor-vue.edbe275b.js";import{C as N}from"./ConnectStatus.1647ee8f.js";import{E as M,A as Y,a as Z,D as ee,b as te,C as oe}from"./ConditionFilterGroup.bb825c35.js";import{F as ae}from"./vendor-lib.4c56f242.js";import{a as ie}from"./element-plus.dcbfaaa8.js";import"./element-icon.ade3aa7e.js";const ne={domain:[{message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],port:[{required:!1,trigger:"blur",validator:(a,o,t)=>{if(!o)return t();if(K(o))t();else return t(new Error("\u7AEF\u53E3\u53F7\u53EA\u80FD\u662F\u6570\u5B57"))}}]},se={name:"",props:{row:{type:Object,default:null}},components:{SelectGroup:j},data(){return{loading:!1,form:{domain:"",alias:"",port:443,group_id:""},rules:ne}},computed:{disabledDomain(){return!!this.row}},methods:{async getData(){if(this.loading=!0,this.row){let a={id:this.row.id},t=(await this.$http.getDomainById(a)).data;this.form.domain=t.domain,this.form.alias=t.alias,this.form.group_id=t.group_id,this.form.port=t.port,this.form.group_id==0&&(this.form.group_id="")}this.loading=!1},handleCancel(){this.$emit("on-cancel")},handleSubmit(){console.log("handleSubmit",this.form),this.$refs.form.validate(a=>{if(console.log(a),a)this.confirmSubmit();else return!1})},async confirmSubmit(){let a=this.$loading({fullscreen:!0}),o={domain:this.form.domain.trim(),alias:this.form.alias.trim(),group_id:this.form.group_id,port:this.form.port},t=null;this.row?(o.id=this.row.id,t=await this.$http.updateDomainById(o)):t=await this.$http.addDomain(o),t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg),this.$nextTick(()=>{a.close()})}},created(){this.getData()}},le={class:"text-center"};function re(a,o,t,h,l,n){const c=s("el-input"),d=s("el-form-item"),u=s("SelectGroup"),S=s("el-form"),f=s("el-button"),x=P("loading");return G((_(),V("div",null,[e(S,{ref:"form",model:l.form,rules:l.rules,"label-width":"60px"},{default:i(()=>[e(d,{label:"\u57DF\u540D",prop:"domain"},{default:i(()=>[e(c,{type:"text",modelValue:l.form.domain,"onUpdate:modelValue":o[0]||(o[0]=g=>l.form.domain=g),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D",disabled:n.disabledDomain},null,8,["modelValue","disabled"])]),_:1}),e(d,{label:"\u7AEF\u53E3",prop:"port"},{default:i(()=>[e(c,{type:"text",modelValue:l.form.port,"onUpdate:modelValue":o[1]||(o[1]=g=>l.form.port=g),placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1}),e(d,{label:"\u5206\u7EC4",prop:"group_id"},{default:i(()=>[e(u,{class:"w-[150px]",modelValue:l.form.group_id,"onUpdate:modelValue":o[2]||(o[2]=g=>l.form.group_id=g),clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"\u5907\u6CE8",prop:"alias"},{default:i(()=>[e(c,{type:"textarea",modelValue:l.form.alias,"onUpdate:modelValue":o[3]||(o[3]=g=>l.form.alias=g),rows:3,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),m("div",le,[e(f,{onClick:n.handleCancel},{default:i(()=>[b("\u53D6 \u6D88")]),_:1},8,["onClick"]),e(f,{type:"primary",onClick:n.handleSubmit},{default:i(()=>[b("\u786E \u5B9A")]),_:1},8,["onClick"])])])),[[x,l.loading]])}const de=C(se,[["render",re]]),ce={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:de},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91\u57DF\u540D":"\u6DFB\u52A0\u57DF\u540D"},dialogVisible:{get(){return this.visible},set(a){this.$emit("update:visible",a)}}},methods:{handleClose(){this.$emit("on-success"),this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function me(a,o,t,h,l,n){const c=s("DataForm"),d=s("el-dialog");return _(),y(d,{title:n.dialogTitle,modelValue:n.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=u=>n.dialogVisible=u),width:"400px",center:"","append-to-body":"","lock-scroll":!1},{default:i(()=>[n.dialogVisible?(_(),y(c,{key:0,row:t.row,onOnCancel:n.handleClose,onOnSuccess:n.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):v("",!0)]),_:1},8,["title","modelValue"])}const H=C(ce,[["render",me]]),ue={name:"",props:{row:{type:Object,default:null}},components:{ConnectStatus:N,ExpireDays:M,AddressList:Y},data(){return{form:{domain:"",domain_url:"",ip:"",start_time:"",expire_time:"",check_time:"",connect_status:"",total_days:"",expire_days:"",create_time:"",update_time:"",detail:{issuer:{},subject:{}},real_time_expire_days:"",domain_start_time:"",domain_expire_time:"",real_time_domain_expire_days:"",alias:"",domain_auto_update:"",domain_auto_update_label:"",domain_expire_monitor:"",domain_check_time_label:"",port:""},ipInfo:{isp:""}}},computed:{},methods:{async getData(){if(this.row){let a={id:this.row.id};const o=await this.$http.getDomainById(a);if(o.code!=0)return;let t=o.data;this.form.domain=t.domain,this.form.domain_url=t.domain_url,this.form.ip=t.ip,this.form.start_time=t.start_time,this.form.expire_time=t.expire_time,this.form.check_time=t.check_time,this.form.connect_status=t.connect_status,this.form.total_days=t.total_days,this.form.expire_days=t.expire_days,this.form.real_time_expire_days=t.real_time_expire_days,this.form.create_time=t.create_time,this.form.update_time=t.update_time,this.form.domain_auto_update=t.domain_auto_update,this.form.domain_auto_update_label=t.domain_auto_update==!0?"\u662F":"\u5426",this.form.domain_expire_monitor=t.domain_expire_monitor==!0?"\u662F":"\u5426",this.form.domain_check_time_label=t.domain_check_time_label,this.form.port=t.port,this.form.alias=t.alias,this.form.domain_start_time=t.domain_start_time,this.form.domain_expire_time=t.domain_expire_time,this.form.real_time_domain_expire_days=t.real_time_domain_expire_days,this.form.detail={issuer:t.detail.issuer||{},subject:t.detail.subject||{}}}},handleCancel(){this.$emit("on-cancel")},async handleUpdateRowDomainInfo(){let a=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),o={domain_id:this.row.id};(await this.$http.updateDomainCertInfoById(o)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.getData()),a.close()},async getIpInfo(){let a={ip:this.form.ip};const o=await this.$http.getIpInfo(a);o.code==0&&(this.ipInfo=o.data)}},created(){this.getData()}},pe={class:"domain-detail"},_e={class:"mo-form-detail grid grid-cols-2"},he={class:"truncate"},fe={class:"flex justify-between flex-1"},ge={class:"truncate"},be={class:"truncate"},De={class:"mo-form-detail mt-[20px]"},we={class:"truncate"},ye={class:"text-center mt-md"};function Ce(a,o,t,h,l,n){const c=s("el-link"),d=s("el-form-item"),u=s("el-form"),S=s("ExpireDays"),f=s("Refresh"),x=s("el-icon"),g=s("el-button");return _(),V("div",pe,[m("div",_e,[e(u,{"label-width":"130px"},{default:i(()=>[e(d,{label:"\u57DF\u540D",prop:"domain"},{default:i(()=>[e(c,{underline:!1,href:l.form.domain_url,target:"_blank"},{default:i(()=>[b(p(l.form.domain),1)]),_:1},8,["href"])]),_:1}),e(d,{label:"\u6CE8\u518C\u65F6\u95F4",prop:"create_time"},{default:i(()=>[m("span",null,p(l.form.domain_start_time||"-"),1)]),_:1}),e(d,{label:"\u5230\u671F\u65F6\u95F4",prop:"create_time"},{default:i(()=>[m("span",null,p(l.form.domain_expire_time||"-"),1)]),_:1}),e(d,{label:"\u81EA\u52A8\u66F4\u65B0",prop:"isp"},{default:i(()=>[m("span",he,p(l.form.domain_auto_update_label||"-"),1)]),_:1})]),_:1}),e(u,{"label-width":"130px",style:{"margin-right":"-1px"}},{default:i(()=>[e(d,{label:"\u7AEF\u53E3\u53F7",prop:"domain"},{default:i(()=>[m("span",null,p(l.form.port||"-"),1)]),_:1}),e(d,{label:"\u5269\u4F59\u5929\u6570",prop:"create_time"},{default:i(()=>[e(S,{value:l.form.real_time_domain_expire_days},null,8,["value"])]),_:1}),e(d,{label:"\u68C0\u67E5\u65F6\u95F4",prop:"isp"},{default:i(()=>[m("div",fe,[m("span",ge,p(l.form.domain_check_time_label||"-"),1),e(c,{underline:!1,type:"primary",class:"mr-sm",disabled:!l.form.domain_auto_update,onClick:n.handleUpdateRowDomainInfo},{default:i(()=>[e(x,null,{default:i(()=>[e(f)]),_:1})]),_:1},8,["disabled","onClick"])])]),_:1}),e(d,{label:"\u8FC7\u671F\u76D1\u6D4B",prop:"isp"},{default:i(()=>[m("span",be,p(l.form.domain_expire_monitor||"-"),1)]),_:1})]),_:1})]),m("div",De,[e(u,{"label-width":"130px"},{default:i(()=>[e(d,{label:"\u5907\u6CE8",prop:"isp"},{default:i(()=>[m("span",we,p(l.form.alias||"-"),1)]),_:1})]),_:1})]),m("div",ye,[e(g,{type:"primary",onClick:n.handleCancel},{default:i(()=>[b("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const Se=C(ue,[["render",Ce]]),xe={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:Se},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(a){this.$emit("update:visible",a)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose()},handleDialogClose(){this.$emit("on-success")}},created(){}};function ke(a,o,t,h,l,n){const c=s("DataForm"),d=s("el-dialog");return _(),y(d,{title:"\u57DF\u540D\u8BE6\u60C5",modelValue:n.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=u=>n.dialogVisible=u),width:"800px",center:"","append-to-body":"","lock-scroll":!1,onClose:n.handleDialogClose},{default:i(()=>[n.dialogVisible?(_(),y(c,{key:0,row:t.row,onOnCancel:n.handleClose,onOnSuccess:n.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):v("",!0)]),_:1},8,["modelValue","onClose"])}const ve=C(xe,[["render",ke]]),Ve={name:"",components:{DataFormDialog:H,DataDetailDialog:ve,ConnectStatus:N,ExpireDays:M,ExpireProgress:Z,DomainSettingDialog:ee,AddressListgDialog:te},emits:["on-success","selection-change","sort-change"],props:{},computed:{},data(){return{currentRow:null,dialogVisible:!1,dialogDetailVisible:!1,DomainSettingDialogVisible:!1,AddressListgDialogVisible:!1}},methods:{handleEditRow(a){this.currentRow=a,this.dialogVisible=!0},async handleDeleteClick(a){let o={id:a.id};const t=await this.$http.deleteDomainById(o);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleStatusChange(a){let o={id:a.id};const t=await this.$Http.function(o);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleMonitorStatusChange(a,o){let t={domain_id:a.id,domain_expire_monitor:o};const h=await this.$http.updateDomainExpireMonitorById(t);h.code==0?this.$msg.success("\u64CD\u4F5C\u6210\u529F"):this.$msg.error(h.msg)},async handleUpdateRowDomainInfo(a){let o=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),t={id:a.id};(await this.$http.updateDomainRowInfoById(t)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")),o.close()},handleUpdateSuccess(){this.$emit("on-success")},handleDetailSuccess(){},handleShowDetail(a){this.currentRow=a,this.dialogDetailVisible=!0},handleDomainSettingDialogShow(a){this.currentRow=a,this.DomainSettingDialogVisible=!0},handleShowAddressListgDialog(a){this.currentRow=a,this.AddressListgDialogVisible=!0}},created(){}},Oe={class:"inline-flex items-center"},Ue=m("span",{class:"mr-[2px]"},"\u8BC1\u4E66\u5929\u6570",-1);function Ie(a,o,t,h,l,n){const c=s("el-table-column"),d=s("el-link"),u=s("el-tooltip"),S=s("Warning"),f=s("el-icon"),x=s("ExpireProgress"),g=s("ConnectStatus"),k=s("el-switch"),O=s("Tickets"),U=s("Refresh"),I=s("Setting"),T=s("Edit"),F=s("Delete"),R=s("el-popconfirm"),$=s("el-table"),B=s("DataFormDialog"),z=s("DataDetailDialog"),A=s("DomainSettingDialog"),D=s("AddressListgDialog");return _(),V("div",null,[e($,Q({stripe:"",border:""},a.$attrs,{onSortChange:o[0]||(o[0]=r=>a.$emit("sort-change",r)),onSelectionChange:o[1]||(o[1]=r=>a.$emit("selection-change",r))}),{default:i(()=>[e(c,{type:"selection","header-align":"center",align:"center",width:"40"}),e(c,{label:"\u57DF\u540D","header-align":"center",align:"center",width:"250","show-overflow-tooltip":"",prop:"domain"},{default:i(r=>[e(u,{disabled:!r.row.alias,content:r.row.alias},{default:i(()=>[e(d,{underline:!1,href:r.row.domain_url,target:"_blank"},{default:i(()=>[b(p(r.row.domain),1)]),_:2},1032,["href"])]),_:2},1032,["disabled","content"])]),_:1}),e(c,{label:"\u7AEF\u53E3","header-align":"center",align:"center",width:"60",sortable:"custom",prop:"port"},{default:i(r=>[m("span",null,p(r.row.port||"-"),1)]),_:1}),e(c,{label:"\u8BC1\u4E66\u5929\u6570","header-align":"center",align:"center",width:"110",sortable:"custom",prop:"expire_days"},{header:i(()=>[e(u,{effect:"dark",content:"\u5982\u6709\u591A\u4E2A\u4E3B\u673AIP\u5730\u5740\uFF0C\u6B64\u5904\u4EC5\u663E\u793A\u5230\u671F\u65F6\u95F4\u6700\u77ED\u7684\u8BC1\u4E66",placement:"top-start","show-after":800},{default:i(()=>[m("div",Oe,[Ue,e(f,null,{default:i(()=>[e(S)]),_:1})])]),_:1})]),default:i(r=>[e(x,{startTime:r.row.start_time,endTime:r.row.expire_time,isManual:!r.row.auto_update},null,8,["startTime","endTime","isManual"])]),_:1}),e(c,{label:"\u4E3B\u673A\u6570\u91CF","header-align":"center",align:"center",width:"80",prop:"address_count"},{default:i(r=>[m("span",null,p(r.row.address_count||"-"),1)]),_:1}),e(c,{label:"\u72B6\u6001","header-align":"center",align:"center",width:"60",sortable:"custom",prop:"connect_status"},{default:i(r=>[e(g,{value:r.row.connect_status,onOnClick:w=>n.handleShowAddressListgDialog(r.row)},null,8,["value","onOnClick"])]),_:1}),e(c,{label:"\u5206\u7EC4","header-align":"center",align:"center",width:"100",sortable:"custom",prop:"group_name"},{default:i(r=>[m("span",null,p(r.row.group_name||"-"),1)]),_:1}),e(c,{label:"\u5907\u6CE8","header-align":"center",align:"left",prop:"check_time","show-overflow-tooltip":""},{default:i(r=>[m("span",null,p(r.row.alias||"-"),1)]),_:1}),e(c,{label:"\u66F4\u65B0\u65F6\u95F4","header-align":"center",align:"center",width:"90",prop:"update_time",sortable:"custom","show-overflow-tooltip":""},{default:i(r=>[m("span",null,p(r.row.update_time_label||"-"),1)]),_:1}),e(c,{label:"\u76D1\u6D4B",width:"60","header-align":"center",align:"center",sortable:"custom",prop:"domain_expire_monitor"},{default:i(r=>[e(k,{style:{transform:"scale(0.8)"},modelValue:r.row.domain_expire_monitor,"onUpdate:modelValue":w=>r.row.domain_expire_monitor=w,onChange:w=>n.handleMonitorStatusChange(r.row,w)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(c,{label:"\u64CD\u4F5C",width:"140","header-align":"center",align:"center"},{default:i(r=>[e(d,{underline:!1,type:"primary",class:"mr-sm",onClick:w=>n.handleShowDetail(r.row)},{default:i(()=>[e(f,null,{default:i(()=>[e(O)]),_:1})]),_:2},1032,["onClick"]),e(d,{underline:!1,type:"primary",class:"mr-sm",disabled:!r.row.domain_auto_update,onClick:w=>n.handleUpdateRowDomainInfo(r.row)},{default:i(()=>[e(f,null,{default:i(()=>[e(U)]),_:1})]),_:2},1032,["disabled","onClick"]),e(d,{underline:!1,type:"primary",class:"mr-sm",onClick:w=>n.handleDomainSettingDialogShow(r.row)},{default:i(()=>[e(f,null,{default:i(()=>[e(I)]),_:1})]),_:2},1032,["onClick"]),e(d,{underline:!1,type:"primary",class:"mr-sm",onClick:w=>n.handleEditRow(r.row)},{default:i(()=>[e(f,null,{default:i(()=>[e(T)]),_:1})]),_:2},1032,["onClick"]),e(R,{title:"\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:w=>n.handleDeleteClick(r.row)},{reference:i(()=>[e(d,{underline:!1,type:"danger"},{default:i(()=>[e(f,null,{default:i(()=>[e(F)]),_:1})]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},16),e(B,{visible:l.dialogVisible,"onUpdate:visible":o[2]||(o[2]=r=>l.dialogVisible=r),row:l.currentRow,onOnSuccess:n.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"]),e(z,{row:l.currentRow,visible:l.dialogDetailVisible,"onUpdate:visible":o[3]||(o[3]=r=>l.dialogDetailVisible=r),onOnSuccess:n.handleDetailSuccess},null,8,["row","visible","onOnSuccess"]),e(A,{row:l.currentRow,visible:l.DomainSettingDialogVisible,"onUpdate:visible":o[4]||(o[4]=r=>l.DomainSettingDialogVisible=r),onOnSuccess:n.handleUpdateSuccess},null,8,["row","visible","onOnSuccess"]),l.currentRow?(_(),y(D,{key:0,domainId:l.currentRow.id,visible:l.AddressListgDialogVisible,"onUpdate:visible":o[5]||(o[5]=r=>l.AddressListgDialogVisible=r),onOnSuccess:n.handleUpdateSuccess},null,8,["domainId","visible","onOnSuccess"])):v("",!0)])}const Te=C(Ve,[["render",Ie]]),Fe={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u66F4\u65B0":"\u5168\u90E8\u66F4\u65B0"}},methods:{async updateAllDomainCertInfoOfUser(){this.updateTimer=setInterval(()=>{this.getUpdateDomainStatusOfUser()},2e3),(await this.$http.updateAllDomainCertInfoOfUser()).code==0&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},async getUpdateDomainStatusOfUser(){const a=await this.$http.getUpdateDomainStatusOfUser();a.ok&&a.data.status==!1&&(clearInterval(this.updateTimer),this.updateTimer=null,this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success"))}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function Re(a,o,t,h,l,n){const c=s("Refresh"),d=s("el-icon"),u=s("el-link");return _(),y(u,{underline:!1,type:"primary",onClick:n.updateAllDomainCertInfoOfUser,disabled:n.disableUpdateButton},{default:i(()=>[e(d,null,{default:i(()=>[e(c)]),_:1}),b(p(n.updateText),1)]),_:1},8,["onClick","disabled"])}const $e=C(Fe,[["render",Re]]),Be={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u68C0\u67E5":"\u8BC1\u4E66\u68C0\u67E5"}},methods:{async checkDomainCert(){this.updateTimer=setInterval(()=>{this.getUpdateDomainStatusOfUser()},2e3),(await this.$http.checkDomainCert()).ok&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},async getUpdateDomainStatusOfUser(){const a=await this.$http.getCheckDomainStatusOfUser();a.ok&&a.data.status==!1&&(clearInterval(this.updateTimer),this.updateTimer=null,this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success"))}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function ze(a,o,t,h,l,n){const c=s("Position"),d=s("el-icon"),u=s("el-link");return _(),y(u,{underline:!1,type:"primary",onClick:n.checkDomainCert,disabled:n.disableUpdateButton},{default:i(()=>[e(d,null,{default:i(()=>[e(c)]),_:1}),b(p(n.updateText),1)]),_:1},8,["onClick","disabled"])}const Ae=C(Be,[["render",ze]]),Ee={name:"ConditionFilter",props:{},components:{ConditionFilterGroup:oe},data(){return{loading:!0,options:[{title:"\u8BC1\u4E66\u72B6\u6001",maxCount:1,field:"expire_days",selected:[],options:[{label:"\u5DF2\u8FC7\u671F",value:[null,3]},{label:"3\u5929\u5185\u8FC7\u671F",value:[0,3]},{label:"7\u5929\u5185\u8FC7\u671F",value:[0,7]},{label:"30\u5929\u5185\u8FC7\u671F",value:[0,30]}]},{title:"\u7F51\u7AD9\u72B6\u6001",field:"connect_status",selected:[],maxCount:1,options:[{label:"\u8FDE\u63A5\u5F02\u5E38",value:"error"},{label:"\u8FDE\u63A5\u6B63\u5E38",value:"success"},{label:"\u72B6\u6001\u672A\u77E5",value:"unknown"}]},{title:"\u57DF\u540D\u5206\u7EC4",field:"group_ids",hidden:!1,selected:[],options:[]}]}},computed:{...q(E,{groupOptions:"getGroupOptions"})},methods:{async getData(){this.options.map(a=>{a.field=="group_ids"&&(this.groupOptions&&this.groupOptions.length>0?a.options=[...this.groupOptions.map(o=>{let t=o.name;return o.domain_count>0&&(t=`${o.name} ${o.domain_count}`),{...o,value:o.id,label:t}}),{label:"\u672A\u5206\u7EC4",value:0}]:a.hidden=!0)}),this.loading=!1},handleChange(a){this.$emit("on-change",this.options)}},created(){this.getData()}},Pe={class:""};function Ge(a,o,t,h,l,n){const c=s("ConditionFilterGroup"),d=P("loading");return G((_(),V("div",Pe,[e(c,{options:l.options,onOnChange:n.handleChange},null,8,["options","onOnChange"])])),[[d,l.loading]])}const Le=C(Ee,[["render",Ge]]),je={name:"domain-list",props:{},components:{DataFormDialog:H,DataTable:Te,SelectGroup:j,UpdateDomainInfo:$e,CheckDomainInfo:Ae,ConditionFilter:Le},data(){return{dataApi:L,list:[],total:0,page:1,size:20,keyword:"",group_id:"",pageSizeCachekey:"pageSize",loading:!0,dialogVisible:!1,export_to_file_url:W(L.exportDomainToFile),order_type:"ascending",order_prop:"expire_days",hasInitData:!1,ConditionFilterParams:[],selectedRows:[]}},computed:{...q(E,{groupOptions:"getGroupOptions"}),showBatchDeleteButton(){return!!(this.selectedRows&&this.selectedRows.length>0)}},methods:{...J(E,{updateGroupOptions:"updateGroupOptions"}),resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let a={page:this.page,size:this.size,group_id:this.group_id,keyword:this.keyword.trim(),order_type:this.order_type,order_prop:this.order_prop};for(let t of this.ConditionFilterParams)t.selected&&t.selected.length>0&&(t.maxCount==1?a[t.field]=t.selected[0]:a[t.field]=t.selected);const o=await this.$http.getDomainList(a);o.code==0?(this.list=o.data.list.map(t=>(t.group_id&&(t.group_name=this.getGroupName(t.group_id)),t)),this.total=o.data.total):this.$msg.error(o.msg),this.loading=!1},getGroupName(a){let o=this.groupOptions.find(t=>t.value==a);if(o)return o.name},async handleHttpRequest(a){let o=this.$loading({fullscreen:!0}),t=new FormData;t.append("file",a.file),(await this.$http.importDomainFromFile(t)).code==0&&(this.$msg.success("\u4E0A\u4F20\u6210\u529F\uFF0C\u540E\u53F0\u5BFC\u5165\u4E2D"),this.resetData()),o.close()},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},async handleExportToFile(){const a=await this.$http.exportDomainFile();a.ok&&ae.saveAs(a.data.url,"domain.txt")},handleSearch(){this.resetData()},handleSizeChange(a){localStorage.setItem(this.pageSizeCachekey,a),this.resetData()},loadPageSize(){let a=localStorage.getItem(this.pageSizeCachekey);a&&(this.size=parseInt(a))},handleExceed(a){this.$refs.upload.clearFiles();const o=a[0];o.uid=ie(),this.handleHttpRequest({file:o})},handleSortChange({column:a,prop:o,order:t}){console.log(a,o,t),this.order_prop="",this.order_type="",t&&(this.order_type=t,this.order_prop=o),this.resetData()},async initData(){this.loadPageSize(),await this.updateGroupOptions(),this.hasInitData=!0,this.getData()},handleSelectionChange(a){this.selectedRows=a},handleConditionFilterChange(a){console.log(a),this.ConditionFilterParams=a,this.resetData()},async handleBatchDeleteConfirm(){let a=this.$loading({fullscreen:!0}),o={ids:this.selectedRows.map(t=>t.id)};try{const t=await this.$http.deleteDomainByIds(o);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData()):this.$msg.error(t.msg)}catch(t){console.log(t)}finally{this.$nextTick(()=>{a.close()})}}},created(){this.keyword=this.$route.query.keyword,this.initData()}},qe={class:"app-container"},Ne={class:"flex",style:{"justify-content":"space-between"}},Me={class:"flex mt-sm",style:{"align-items":"center"}},He={style:{"font-size":"14px",color:"#333333"}},Ke={class:"flex",style:{"margin-left":"auto"}},We=m("div",{style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},null,-1);function Qe(a,o,t,h,l,n){const c=s("Plus"),d=s("el-icon"),u=s("el-button"),S=s("Search"),f=s("el-input"),x=s("ConditionFilter"),g=s("Delete"),k=s("el-link"),O=s("el-popconfirm"),U=s("UpdateDomainInfo"),I=s("CheckDomainInfo"),T=s("Upload"),F=s("el-upload"),R=s("Download"),$=s("DataTable"),B=s("el-pagination"),z=s("DataFormDialog"),A=P("loading");return _(),V("div",qe,[m("div",Ne,[e(u,{type:"primary",onClick:n.handleAddRow},{default:i(()=>[e(d,null,{default:i(()=>[e(c)]),_:1}),b("\u6DFB\u52A0")]),_:1},8,["onClick"]),e(f,{class:"ml-sm",style:{width:"260px"},modelValue:l.keyword,"onUpdate:modelValue":o[0]||(o[0]=D=>l.keyword=D),placeholder:"\u641C\u7D22\u57DF\u540D",clearable:"",onKeypress:X(n.handleSearch,["enter"]),onClear:n.handleSearch},{append:i(()=>[e(u,{onClick:n.handleSearch},{default:i(()=>[e(d,null,{default:i(()=>[e(S)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),l.hasInitData?(_(),y(x,{key:0,class:"mt-md",onOnChange:n.handleConditionFilterChange},null,8,["onOnChange"])):v("",!0),m("div",Me,[m("div",He,"\u5171\u8BA1 "+p(l.total)+" \u6761\u6570\u636E",1),m("div",Ke,[n.showBatchDeleteButton?(_(),y(O,{key:0,title:"\u786E\u5B9A\u5220\u9664\u9009\u4E2D\uFF1F",onConfirm:n.handleBatchDeleteConfirm},{reference:i(()=>[e(k,{underline:!1,type:"danger",class:"mr-sm"},{default:i(()=>[e(d,null,{default:i(()=>[e(g)]),_:1}),b("\u6279\u91CF\u5220\u9664")]),_:1})]),_:1},8,["onConfirm"])):v("",!0),e(U,{onOnSuccess:n.resetData},null,8,["onOnSuccess"]),e(I,{class:"ml-sm",onOnSuccess:n.resetData},null,8,["onOnSuccess"]),e(k,{underline:!1,type:"primary",class:"ml-sm",style:{position:"relative"}},{default:i(()=>[e(d,null,{default:i(()=>[e(T)]),_:1}),b("\u5BFC\u5165 "),e(F,{ref:"upload",action:"action",accept:".txt",limit:1,"on-exceed":n.handleExceed,"show-file-list":!1,"http-request":n.handleHttpRequest},{default:i(()=>[We]),_:1},8,["on-exceed","http-request"])]),_:1}),e(k,{underline:!1,type:"primary",class:"ml-sm",onClick:n.handleExportToFile},{default:i(()=>[e(d,null,{default:i(()=>[e(R)]),_:1}),b("\u5BFC\u51FA")]),_:1},8,["onClick"])])]),G(e($,{class:"mt-sm",data:l.list,onOnSuccess:n.resetData,onSortChange:n.handleSortChange,onSelectionChange:n.handleSelectionChange},null,8,["data","onOnSuccess","onSortChange","onSelectionChange"]),[[A,l.loading]]),e(B,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:l.total,"page-size":l.size,"onUpdate:pageSize":o[1]||(o[1]=D=>l.size=D),"current-page":l.page,"onUpdate:currentPage":o[2]||(o[2]=D=>l.page=D),onCurrentChange:n.getData,onSizeChange:n.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),e(z,{visible:l.dialogVisible,"onUpdate:visible":o[3]||(o[3]=D=>l.dialogVisible=D),onOnSuccess:n.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const nt=C(je,[["render",Qe]]);export{nt as default};
